<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WarpLab â€” Feel Spacetime Bend</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŒ€</text></svg>" />
    <meta name="theme-color" content="#000005" />
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png" />

    <!-- Open Graph -->
    <meta property="og:title" content="WarpLab â€” Feel Spacetime Bend" />
    <meta property="og:description" content="Interactive gravitational wave visualizer. Watch black holes merge in 3D, hear the chirp, explore 90+ real events from LIGO/Virgo/KAGRA." />
    <meta property="og:image" content="https://www.warplab.app/og.jpg" />
    <meta property="og:url" content="https://warplab.app/app.html" />
    <meta property="og:type" content="website" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="WarpLab â€” Feel Spacetime Bend" />
    <meta name="twitter:description" content="Interactive gravitational wave visualizer. Watch black holes merge in 3D, hear the chirp, explore 90+ real events." />
    <meta name="twitter:image" content="https://www.warplab.app/og.jpg" />
    <meta name="twitter:creator" content="@coco_canton" />
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body {
        background: #000;
        color: #fff;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
        overflow: hidden;
      }
      canvas { display: block; }

      /* â”€â”€â”€ Glass panels (shared) â”€â”€â”€ */
      .glass {
        background: rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(12px);
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.06);
      }

      /* â”€â”€â”€ Event Info Panel â”€â”€â”€ */
      #event-info {
        position: fixed;
        top: 24px;
        left: 24px;
        z-index: 10;
        font-size: 13px;
        line-height: 1.8;
        padding: 16px 20px;
        min-width: 240px;
        max-width: 340px;
        overflow: hidden;
      }
      #event-info .panel-body {
        padding: 0;
      }
      .info-header {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        margin-bottom: 6px;
        cursor: grab;
        user-select: none;
      }
      .info-header:active { cursor: grabbing; }
      #event-info h2 {
        font-size: 22px;
        font-weight: 600;
        letter-spacing: -0.02em;
      }
      .help-btn {
        width: 24px;
        height: 24px;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 50%;
        color: rgba(255, 255, 255, 0.5);
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
        flex-shrink: 0;
        margin-top: 4px;
      }
      .help-btn:hover { background: rgba(255, 255, 255, 0.15); color: #fff; }
      .share-btn {
        width: 24px;
        height: 24px;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 50%;
        color: rgba(255, 255, 255, 0.5);
        font-size: 12px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
        flex-shrink: 0;
        margin-top: 4px;
      }
      .share-btn:hover { background: rgba(255, 255, 255, 0.15); color: #fff; }

      /* â”€â”€â”€ Share Toast â”€â”€â”€ */
      #share-toast {
        position: fixed;
        bottom: 140px;
        left: 50%;
        transform: translateX(-50%) translateY(20px);
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 8px 18px;
        font-size: 13px;
        color: rgba(255, 255, 255, 0.85);
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s ease, transform 0.3s ease;
        z-index: 100;
      }
      #share-toast.show {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }

      /* â”€â”€â”€ Export Button & Toast â”€â”€â”€ */
      .export-btn {
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 6px;
        color: rgba(255, 255, 255, 0.6);
        font-size: 11px;
        cursor: pointer;
        display: none;
        align-items: center;
        gap: 4px;
        padding: 3px 8px;
        transition: all 0.2s;
        flex-shrink: 0;
        font-family: inherit;
      }
      .export-btn:hover { background: rgba(255, 255, 255, 0.15); color: #fff; }
      .export-btn.visible { display: flex; }
      .export-btn svg { opacity: 0.7; }
      .export-btn:hover svg { opacity: 1; }
      #export-toast {
        position: fixed;
        bottom: 140px;
        left: 50%;
        transform: translateX(-50%) translateY(20px);
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 8px 18px;
        font-size: 13px;
        color: rgba(255, 255, 255, 0.85);
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s ease, transform 0.3s ease;
        z-index: 100;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      #export-toast.show {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
      .export-spinner {
        width: 14px;
        height: 14px;
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-top-color: rgba(255, 255, 255, 0.8);
        border-radius: 50%;
        animation: export-spin 0.6s linear infinite;
      }
      @keyframes export-spin {
        to { transform: rotate(360deg); }
      }
      .type-badge {
        display: inline-block;
        border-radius: 4px;
        padding: 1px 8px;
        font-size: 11px;
        font-weight: 500;
        margin-bottom: 6px;
      }
      .type-badge.bbh { background: rgba(129, 140, 248, 0.2); border: 1px solid rgba(129, 140, 248, 0.3); color: #a5b4fc; }
      .type-badge.bns { background: rgba(34, 211, 238, 0.2); border: 1px solid rgba(34, 211, 238, 0.3); color: #67e8f9; }
      .type-badge.nsbh { background: rgba(251, 191, 36, 0.2); border: 1px solid rgba(251, 191, 36, 0.3); color: #fcd34d; }
      #event-info .param { color: rgba(255, 255, 255, 0.45); }
      #event-info .value { color: #fff; font-variant-numeric: tabular-nums; }
      .info-divider {
        border: none;
        border-top: 1px solid rgba(255, 255, 255, 0.06);
        margin: 8px 0;
      }
      .info-detail { color: rgba(255, 255, 255, 0.35); font-size: 12px; line-height: 1.7; }
      .info-detail .value { color: rgba(255, 255, 255, 0.7); }
      .snr-badge {
        display: inline-block;
        background: rgba(99, 102, 241, 0.2);
        border: 1px solid rgba(99, 102, 241, 0.3);
        border-radius: 4px;
        padding: 1px 6px;
        font-size: 11px;
        color: #a5b4fc;
        margin-left: 4px;
      }
      .pastro-badge {
        display: inline-block;
        border-radius: 4px;
        padding: 1px 6px;
        font-size: 11px;
        margin-left: 4px;
      }
      .pastro-badge.high { background: rgba(74, 222, 128, 0.15); border: 1px solid rgba(74, 222, 128, 0.25); color: #86efac; }
      .pastro-badge.med { background: rgba(251, 191, 36, 0.15); border: 1px solid rgba(251, 191, 36, 0.25); color: #fcd34d; }
      .pastro-badge.low { background: rgba(248, 113, 113, 0.15); border: 1px solid rgba(248, 113, 113, 0.25); color: #fca5a5; }
      .info-catalog {
        font-size: 10px;
        color: rgba(255, 255, 255, 0.2);
        margin-top: 4px;
      }
      /* â”€â”€â”€ View-mode gating â”€â”€â”€ */
      .uncertainty {
        color: rgba(255, 255, 255, 0.35);
        font-size: 11px;
        font-variant-numeric: tabular-nums;
      }

      /* â”€â”€â”€ Help Overlay â”€â”€â”€ */
      #help-overlay {
        position: fixed;
        top: 24px;
        left: 24px;
        z-index: 20;
        padding: 20px 24px;
        min-width: 320px;
        max-width: 380px;
        max-height: calc(100vh - 48px);
        overflow-y: auto;
        font-size: 13px;
        line-height: 1.6;
        display: none;
      }
      #help-overlay h2 {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 12px;
      }
      .help-intro {
        color: rgba(255, 255, 255, 0.7);
        margin-bottom: 16px;
        font-size: 13px;
        line-height: 1.6;
      }
      .help-glossary dt {
        color: rgba(255, 255, 255, 0.9);
        font-weight: 500;
        font-size: 12px;
        margin-top: 8px;
      }
      .help-glossary dd {
        color: rgba(255, 255, 255, 0.45);
        font-size: 12px;
        margin-left: 0;
        margin-bottom: 2px;
      }
      .help-footer {
        font-size: 10px;
        color: rgba(255, 255, 255, 0.2);
        margin-top: 16px;
        padding-top: 10px;
        border-top: 1px solid rgba(255, 255, 255, 0.06);
      }
      .help-close {
        position: absolute;
        top: 14px;
        right: 14px;
        width: 24px;
        height: 24px;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 50%;
        color: rgba(255, 255, 255, 0.5);
        font-size: 14px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.15s;
      }
      .help-close:hover { background: rgba(255, 255, 255, 0.15); color: #fff; }

      /* â”€â”€â”€ Event Filters â”€â”€â”€ */
      .filter-bar {
        display: flex;
        gap: 4px;
        flex-wrap: wrap;
        margin-bottom: 8px;
        padding: 0 4px;
      }
      .filter-chip {
        padding: 3px 10px;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        background: transparent;
        color: rgba(255, 255, 255, 0.4);
        font-size: 11px;
        cursor: pointer;
        transition: all 0.15s;
      }
      .filter-chip:hover { background: rgba(255, 255, 255, 0.06); color: rgba(255, 255, 255, 0.6); }
      .filter-chip.active { border-color: rgba(99, 102, 241, 0.4); color: #a5b4fc; background: rgba(99, 102, 241, 0.12); }
      .filter-chip.active.bbh { border-color: rgba(129, 140, 248, 0.4); color: #a5b4fc; background: rgba(129, 140, 248, 0.12); }
      .filter-chip.active.bns { border-color: rgba(34, 211, 238, 0.4); color: #67e8f9; background: rgba(34, 211, 238, 0.12); }
      .filter-chip.active.nsbh { border-color: rgba(251, 191, 36, 0.4); color: #fcd34d; background: rgba(251, 191, 36, 0.12); }
      .sort-row {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 0 8px;
        margin-bottom: 8px;
      }
      .sort-row label {
        font-size: 10px;
        color: rgba(255, 255, 255, 0.25);
        text-transform: uppercase;
        letter-spacing: 0.06em;
      }
      .sort-select {
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 4px;
        color: rgba(255, 255, 255, 0.6);
        font-size: 11px;
        padding: 2px 6px;
        cursor: pointer;
        outline: none;
      }
      .sort-select:hover { border-color: rgba(255, 255, 255, 0.2); }
      .sort-select option { background: #1a1a2e; color: #fff; }

      /* â”€â”€â”€ Event List â”€â”€â”€ */
      #event-list {
        position: fixed;
        top: 24px;
        right: 24px;
        width: 260px;
        max-height: calc(100vh - 48px);
        overflow-y: auto;
        z-index: 10;
        font-size: 13px;
        padding: 0;
        overflow: hidden;
      }
      #event-list .panel-body {
        padding: 12px;
        max-height: calc(100vh - 96px);
        overflow-y: auto;
      }
      #event-list::-webkit-scrollbar { width: 4px; }
      #event-list::-webkit-scrollbar-track { background: transparent; }
      #event-list::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); border-radius: 2px; }
      #event-list h3 {
        font-size: 11px;
        margin-bottom: 8px;
        color: rgba(255, 255, 255, 0.35);
        text-transform: uppercase;
        letter-spacing: 0.08em;
        font-weight: 500;
        padding: 0 8px;
      }
      #event-count {
        font-size: 10px;
        color: rgba(255, 255, 255, 0.25);
        padding: 0 8px;
        margin-bottom: 8px;
      }
      .event-item {
        padding: 6px 10px;
        border-radius: 6px;
        cursor: pointer;
        transition: background 0.15s;
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        gap: 8px;
        border: 1px solid transparent;
      }
      .event-item > span:first-child {
        min-width: 0;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
      .event-item:hover { background: rgba(255, 255, 255, 0.06); }
      .event-item.active {
        background: rgba(99, 102, 241, 0.15);
        border-color: rgba(99, 102, 241, 0.3);
      }
      .event-item .mass {
        color: rgba(255, 255, 255, 0.3);
        font-size: 11px;
        white-space: nowrap;
        flex-shrink: 0;
        text-align: right;
      }

      /* â”€â”€â”€ Time Controls â”€â”€â”€ */
      #time-controls {
        position: fixed;
        bottom: 80px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        align-items: center;
        gap: 10px;
        z-index: 10;
        padding: 8px 16px;
        border-radius: 24px;
      }
      .ctrl-btn {
        width: 32px;
        height: 32px;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 50%;
        color: #fff;
        font-size: 12px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.15s;
      }
      .ctrl-btn:hover { background: rgba(255, 255, 255, 0.15); }
      #time-slider { width: 280px; accent-color: #6366f1; height: 4px; }
      #time-label {
        font-size: 11px; color: rgba(255, 255, 255, 0.4);
        font-variant-numeric: tabular-nums; min-width: 48px; text-align: right;
      }
      #speed-label {
        font-size: 10px; color: rgba(255, 255, 255, 0.35);
        min-width: 28px; text-align: center;
      }

      /* â”€â”€â”€ Bottom Bar â”€â”€â”€ */
      #ui {
        position: fixed;
        bottom: 24px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 8px;
        align-items: center;
        z-index: 10;
      }
      .ui-btn {
        padding: 10px 20px;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 8px;
        color: rgba(255, 255, 255, 0.7);
        font-size: 13px;
        cursor: pointer;
        backdrop-filter: blur(10px);
        transition: all 0.2s;
        letter-spacing: 0.02em;
      }
      .ui-btn:hover { background: rgba(255, 255, 255, 0.15); color: #fff; }

      /* â”€â”€â”€ Map Legend â”€â”€â”€ */
      #map-legend {
        position: fixed;
        top: 24px;
        left: 24px;
        z-index: 10;
        padding: 16px 20px;
        font-size: 13px;
        line-height: 2;
        display: none;
      }
      #map-legend h2 {
        font-size: 18px;
        margin-bottom: 8px;
        font-weight: 600;
      }
      .legend-dot {
        display: inline-block;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        margin-right: 8px;
        vertical-align: middle;
      }
      .legend-dot.bbh { background: #818cf8; }
      .legend-dot.bns { background: #22d3ee; }
      .legend-dot.nsbh { background: #fbbf24; }
      .legend-label { color: rgba(255, 255, 255, 0.6); }
      .legend-hint {
        font-size: 11px;
        color: rgba(255, 255, 255, 0.25);
        margin-top: 8px;
        line-height: 1.5;
      }

      /* â”€â”€â”€ Branding â”€â”€â”€ */
      #brand-bar {
        position: fixed;
        bottom: 28px;
        left: 24px;
        z-index: 10;
        display: flex;
        align-items: center;
        gap: 12px;
      }
      #brand {
        font-size: 13px;
        color: rgba(255, 255, 255, 0.2);
        letter-spacing: 0.15em;
        text-transform: uppercase;
        font-weight: 600;
        cursor: pointer;
        transition: color 0.2s ease;
      }
      #brand:hover {
        color: rgba(255, 255, 255, 0.5);
      }
      .gh-link {
        display: flex;
        align-items: center;
        gap: 5px;
        color: rgba(255, 255, 255, 0.2);
        text-decoration: none;
        font-size: 11px;
        transition: color 0.2s ease;
      }
      .gh-link:hover { color: rgba(255, 255, 255, 0.5); }
      .gh-link svg { width: 14px; height: 14px; }

      /* â”€â”€â”€ UI Polish & Animations â”€â”€â”€ */
      .glass {
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
      }
      .glass:hover {
        border-color: rgba(255, 255, 255, 0.1);
        box-shadow: 0 0 20px rgba(99, 102, 241, 0.04);
      }
      #play-btn {
        animation: pulse-subtle 2.5s ease-in-out infinite;
      }
      #play-btn:hover {
        animation: none;
        background: rgba(99, 102, 241, 0.25);
        border-color: rgba(99, 102, 241, 0.4);
      }
      @keyframes pulse-subtle {
        0%, 100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); }
        50% { box-shadow: 0 0 12px 2px rgba(99, 102, 241, 0.2); }
      }
      .event-item {
        transition: all 0.2s ease;
      }
      .event-item:hover {
        background: rgba(99, 102, 241, 0.08);
        border-left: 2px solid rgba(99, 102, 241, 0.4);
        padding-left: 14px;
      }
      .event-item.active {
        border-left: 2px solid #6366f1;
        padding-left: 14px;
      }
      #event-info {
        animation: slide-in-left 0.4s ease both;
      }
      @keyframes slide-in-left {
        from { opacity: 0; transform: translateX(-12px); }
        to { opacity: 1; transform: translateX(0); }
      }
      .info-detail {
        transition: opacity 0.3s ease;
      }
      .ui-btn {
        transition: all 0.2s ease;
      }
      .ui-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      }
      .ui-btn:active {
        transform: translateY(0);
      }
      .ctrl-btn {
        transition: all 0.15s ease;
      }
      .ctrl-btn:active {
        transform: scale(0.92);
      }

      /* â”€â”€â”€ Keyboard hints â”€â”€â”€ */
      .kbd {
        display: inline-block;
        padding: 1px 5px;
        background: rgba(255,255,255,0.08);
        border: 1px solid rgba(255,255,255,0.15);
        border-radius: 3px;
        font-size: 10px;
        font-family: monospace;
        color: rgba(255,255,255,0.4);
        margin-left: 4px;
      }

      /* â”€â”€â”€ Loading Screen â”€â”€â”€ */
      #loading-screen {
        position: fixed;
        inset: 0;
        z-index: 100;
        background: #000005;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        transition: opacity 0.6s ease;
      }
      #loading-screen.fade-out { opacity: 0; pointer-events: none; }
      .loading-title {
        font-size: 28px;
        font-weight: 600;
        letter-spacing: 0.2em;
        text-transform: uppercase;
        color: rgba(255, 255, 255, 0.8);
        margin-bottom: 24px;
      }
      .loading-ring {
        width: 40px;
        height: 40px;
        border: 2px solid rgba(99, 102, 241, 0.15);
        border-top-color: #6366f1;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        margin-bottom: 16px;
      }
      @keyframes spin { to { transform: rotate(360deg); } }
      .loading-status {
        font-size: 12px;
        color: rgba(255, 255, 255, 0.3);
        letter-spacing: 0.04em;
      }

      /* â”€â”€â”€ Search Input â”€â”€â”€ */
      .search-row {
        padding: 0 4px;
        margin-bottom: 8px;
      }
      .search-input {
        width: 100%;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 6px;
        color: rgba(255, 255, 255, 0.8);
        font-size: 12px;
        padding: 5px 10px;
        outline: none;
        transition: border-color 0.15s;
      }
      .search-input::placeholder { color: rgba(255, 255, 255, 0.2); }
      .search-input:focus { border-color: rgba(99, 102, 241, 0.4); }

      /* â”€â”€â”€ Onboarding Hints â”€â”€â”€ */
      #onboarding {
        position: fixed;
        inset: 0;
        z-index: 50;
        pointer-events: none;
        transition: opacity 0.8s ease;
      }
      #onboarding.hidden { opacity: 0; pointer-events: none; }
      .hint {
        position: absolute;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(8px);
        border: 1px solid rgba(99, 102, 241, 0.25);
        border-radius: 10px;
        padding: 10px 14px;
        font-size: 12px;
        color: rgba(255, 255, 255, 0.7);
        max-width: 200px;
        line-height: 1.5;
        pointer-events: auto;
        animation: hint-in 0.6s ease both;
      }
      .hint strong { color: #a5b4fc; font-weight: 500; }
      .hint-1 { top: 100px; left: 30px; animation-delay: 0.3s; }
      .hint-2 { bottom: 140px; left: 50%; transform: translateX(-50%); animation-delay: 0.6s; }
      .hint-3 { top: 50%; right: 30px; transform: translateY(-50%); animation-delay: 0.9s; }
      .hint-4 { bottom: 70px; right: 30px; animation-delay: 1.2s; }
      @keyframes hint-in {
        from { opacity: 0; transform: translateY(8px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .hint-dismiss {
        display: block;
        margin-top: 6px;
        font-size: 10px;
        color: rgba(255, 255, 255, 0.3);
      }

      /* â”€â”€â”€ About Overlay â”€â”€â”€ */
      #about-overlay {
        position: fixed;
        inset: 0;
        z-index: 60;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(12px);
        display: none;
        align-items: center;
        justify-content: center;
      }
      #about-overlay.show { display: flex; }
      .about-card {
        background: rgba(10, 10, 20, 0.9);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 16px;
        padding: 32px 36px;
        max-width: 380px;
        text-align: center;
      }
      .about-card h2 {
        font-size: 22px;
        font-weight: 600;
        margin-bottom: 6px;
      }
      .about-card .about-tagline {
        font-size: 13px;
        color: rgba(255, 255, 255, 0.4);
        margin-bottom: 20px;
      }
      .about-card .about-desc {
        font-size: 13px;
        color: rgba(255, 255, 255, 0.55);
        line-height: 1.7;
        margin-bottom: 20px;
      }
      .about-links {
        display: flex;
        justify-content: center;
        gap: 16px;
        margin-bottom: 16px;
      }
      .about-links a {
        color: rgba(255, 255, 255, 0.4);
        text-decoration: none;
        font-size: 12px;
        transition: color 0.15s;
      }
      .about-links a:hover { color: #a5b4fc; }
      .about-credit {
        font-size: 11px;
        color: rgba(255, 255, 255, 0.2);
        margin-top: 12px;
      }
      .about-close {
        position: absolute;
        top: 20px;
        right: 24px;
        width: 28px;
        height: 28px;
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        color: rgba(255, 255, 255, 0.4);
        font-size: 16px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.15s;
      }
      .about-close:hover { background: rgba(255,255,255,0.12); color: #fff; }

      /* â”€â”€â”€ Map Tooltip â”€â”€â”€ */
      #map-tooltip {
        position: fixed;
        z-index: 15;
        padding: 6px 12px;
        font-size: 12px;
        pointer-events: none;
        display: none;
        white-space: nowrap;
      }
      .tooltip-name { color: #fff; font-weight: 500; }
      .tooltip-detail { color: rgba(255, 255, 255, 0.4); font-size: 11px; margin-left: 8px; }

      /* â”€â”€ Screenshot button icon â”€â”€ */
      .btn-icon { vertical-align: -3px; margin-right: 2px; }

      /* â”€â”€â”€ Tour Menu â”€â”€â”€ */
      #tour-menu {
        position: fixed;
        bottom: 80px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 25;
        padding: 12px 16px;
        min-width: 240px;
        max-width: 320px;
        display: none;
      }
      #tour-menu.show { display: block; }
      #tour-menu h3 {
        font-size: 11px;
        color: rgba(255, 255, 255, 0.35);
        text-transform: uppercase;
        letter-spacing: 0.08em;
        font-weight: 500;
        margin-bottom: 8px;
      }
      .tour-option {
        display: block;
        width: 100%;
        padding: 8px 12px;
        border-radius: 6px;
        border: 1px solid transparent;
        background: transparent;
        color: rgba(255, 255, 255, 0.7);
        font-size: 13px;
        cursor: pointer;
        text-align: left;
        transition: all 0.15s;
        margin-bottom: 2px;
      }
      .tour-option:hover {
        background: rgba(99, 102, 241, 0.1);
        border-color: rgba(99, 102, 241, 0.2);
        color: #fff;
      }
      .tour-option .tour-option-count {
        color: rgba(255, 255, 255, 0.25);
        font-size: 11px;
        margin-left: 6px;
      }

      /* â”€â”€â”€ Tour Overlay â”€â”€â”€ */
      #tour-overlay {
        position: fixed;
        bottom: 130px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 20;
        padding: 16px 20px;
        max-width: 400px;
        width: 90%;
        display: none;
        pointer-events: auto;
      }
      #tour-overlay.show { display: block; }
      .tour-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 8px;
      }
      .tour-name {
        font-size: 11px;
        color: rgba(99, 102, 241, 0.8);
        text-transform: uppercase;
        letter-spacing: 0.06em;
        font-weight: 500;
      }
      .tour-step-counter {
        font-size: 11px;
        color: rgba(255, 255, 255, 0.3);
        font-variant-numeric: tabular-nums;
      }
      .tour-event-name {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 6px;
      }
      .tour-description {
        font-size: 13px;
        color: rgba(255, 255, 255, 0.6);
        line-height: 1.6;
        margin-bottom: 12px;
      }
      .tour-nav {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
      }
      .tour-nav-btn {
        padding: 6px 16px;
        border-radius: 6px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: rgba(255, 255, 255, 0.06);
        color: rgba(255, 255, 255, 0.6);
        font-size: 12px;
        cursor: pointer;
        transition: all 0.15s;
      }
      .tour-nav-btn:hover { background: rgba(255, 255, 255, 0.12); color: #fff; }
      .tour-nav-btn:disabled { opacity: 0.3; cursor: default; }
      .tour-nav-btn:disabled:hover { background: rgba(255, 255, 255, 0.06); color: rgba(255, 255, 255, 0.6); }
      .tour-exit-btn {
        padding: 6px 12px;
        border-radius: 6px;
        border: 1px solid rgba(248, 113, 113, 0.2);
        background: rgba(248, 113, 113, 0.08);
        color: rgba(248, 113, 113, 0.7);
        font-size: 11px;
        cursor: pointer;
        transition: all 0.15s;
      }
      .tour-exit-btn:hover { background: rgba(248, 113, 113, 0.15); color: #fca5a5; }
      .tour-nav-group {
        display: flex;
        gap: 6px;
      }

      /* â”€â”€ Events toggle button (mobile only) â”€â”€ */
      .mobile-only { display: none; }

      /* â”€â”€â”€ Embed Mode â”€â”€â”€ */
      body.embed { overflow: hidden; }
      body.embed #brand-bar,
      body.embed #event-list,
      body.embed #help-overlay,
      body.embed #about-overlay,
      body.embed #onboarding,
      body.embed #map-legend,
      body.embed #ui { display: none !important; }
      body.embed #event-info {
        top: 12px;
        left: 12px;
        padding: 10px 14px;
        font-size: 12px;
        min-width: 200px;
        max-width: 260px;
      }
      body.embed #event-info .panel-minimize-btn { display: none; }
      body.embed #event-info h2 { font-size: 16px; }
      body.embed #event-info .help-btn { display: none; }
      body.embed #event-info .info-divider,
      body.embed #event-info .info-detail,
      body.embed #event-info .info-catalog { display: none; }
      body.embed #time-controls {
        bottom: 12px;
        left: 50%;
        transform: translateX(-50%);
        padding: 6px 14px;
        border-radius: 20px;
      }
      body.embed #spectrogram-panel { display: none !important; }
      body.embed #strain-chart-panel { display: none !important; }
      /* Embed: scene selector hidden (scene chosen via ?scene= param) */
      body.embed #scene-selector { display: none !important; }
      /* Embed: compact panels for non-merger scenes */
      body.embed #blackhole-panel {
        top: 12px; left: 12px;
        padding: 10px 14px;
        min-width: 180px; max-width: 220px;
        font-size: 12px;
      }
      body.embed #blackhole-panel .bh-hint { display: none; }
      body.embed #sandbox-panel {
        top: 12px; left: 12px;
        padding: 10px 14px;
        min-width: 200px; max-width: 240px;
        font-size: 12px;
      }
      body.embed #sandbox-panel .sandbox-hint { display: none; }
      body.embed #nbody-panel {
        top: 12px; left: 12px;
        padding: 10px 14px;
        min-width: 200px; max-width: 240px;
        font-size: 12px;
      }
      body.embed #nbody-panel .nb-hint { display: none; }
      body.embed #nbody-panel .nb-info { display: none; }
      body.embed #nbody-panel .nb-collapsible { display: none; }
      body.embed #nbody-panel .nb-expand-btn { display: inline-block; }

      /* â”€â”€ Mobile â”€â”€ */
      @media (max-width: 768px) {
        .mobile-only { display: block; }

        /* Hide heavy panels */
        #onboarding,
        #map-tooltip { display: none !important; }

        /* Help overlay â€” mobile fullscreen sheet */
        #help-overlay {
          top: 48px; bottom: 80px; left: 12px; right: 12px;
          min-width: 0; max-width: none;
          max-height: none;
          border-radius: 14px;
          padding: 16px 18px;
          font-size: 12px;
          z-index: 35;
        }
        #help-overlay h2 { font-size: 16px; margin-bottom: 8px; }
        .help-intro { font-size: 12px; margin-bottom: 12px; }
        .help-glossary dt { font-size: 11px; margin-top: 6px; }
        .help-glossary dd { font-size: 11px; }
        .help-footer .kbd { display: none; }

        /* Compact event info â€” just name + type + masses */
        #event-info {
          top: auto; bottom: 80px; left: 12px; right: 12px;
          max-width: none; min-width: 0;
          padding: 0;
          border-radius: 14px;
          animation: none;
          line-height: 1.4;
        }
        #event-info .panel-body {
          display: flex;
          flex-wrap: wrap;
          align-items: center;
          gap: 6px 10px;
        }
        #event-info .info-header {
          width: 100%;
          margin-bottom: 0;
        }
        #event-info .panel-minimize-btn { display: none; }
        #event-info h2 { font-size: 16px; }
        #event-info .help-btn { display: flex; width: 22px; height: 22px; font-size: 11px; margin-top: 0; }
        #event-info .share-btn { display: flex; width: 22px; height: 22px; margin-top: 0; }
        #event-info .info-divider,
        #event-info .info-detail,
        #event-info .info-catalog { display: none; }
        .type-badge { margin-bottom: 0; font-size: 10px; padding: 1px 6px; }

        /* Event list â€” mobile overlay (hidden by default, toggled via JS) */
        #event-list {
          position: fixed;
          top: 48px; bottom: 80px; left: 12px; right: 12px;
          width: auto;
          max-height: none;
          border-radius: 14px;
          z-index: 30;
          display: none;
          padding: 0;
        }
        #event-list .panel-header { display: none; }
        #event-list .panel-body { padding: 12px; max-height: none; }
        #event-list.mobile-open { display: block; }
        #event-list h3 { font-size: 10px; }

        /* Map legend â€” compact bottom card */
        #map-legend {
          top: auto !important; bottom: 80px; left: 12px; right: 12px;
          padding: 10px 14px;
          border-radius: 14px;
          font-size: 12px;
          line-height: 1.6;
        }
        #map-legend h2 { font-size: 14px; margin-bottom: 4px; }
        .legend-hint { display: none; }

        /* Brand â€” top left, smaller */
        #brand-bar {
          bottom: auto; top: calc(env(safe-area-inset-top, 0px) + 16px);
          left: 16px;
          font-size: 12px;
        }
        #brand { font-size: 11px; letter-spacing: 0.12em; }
        #brand-bar .gh-link { display: none; }

        /* Time controls â€” full width bottom bar */
        #time-controls {
          left: 12px; right: 12px; bottom: 12px;
          width: auto;
          transform: none;
          padding: 10px 14px;
          border-radius: 14px;
          gap: 8px;
        }
        #time-slider { width: 1px; flex: 1; }
        #time-label { font-size: 10px; min-width: 36px; }
        #speed-label { display: none; }
        #speed-btn { display: none; }
        .ctrl-btn { width: 36px; height: 36px; font-size: 14px; }

        /* Bottom buttons â€” top right, no overlap */
        #ui {
          bottom: auto; top: calc(env(safe-area-inset-top, 0px) + 16px);
          left: auto; right: 16px;
          transform: none;
          gap: 6px;
        }
        .ui-btn {
          font-size: 11px;
          padding: 7px 12px;
          border-radius: 10px;
        }
        .btn-label { display: none; }
        .btn-icon { margin-right: 0; }

        /* Tour â€” mobile full-width */
        #tour-menu {
          left: 12px; right: 12px;
          transform: none;
          min-width: 0; max-width: none;
          bottom: 70px;
          border-radius: 14px;
        }
        #tour-overlay {
          left: 12px; right: 12px;
          transform: none;
          max-width: none;
          bottom: 70px;
          border-radius: 14px;
        }
        .tour-event-name { font-size: 15px; }
        .tour-description { font-size: 12px; }

        /* Spectrogram â€” compact on mobile */
        #spectrogram-panel {
          bottom: 70px;
          right: 8px;
          left: auto;
          width: calc(100vw - 16px);
          height: 134px;
          border-radius: 10px;
        }

        /* Strain chart â€” compact on mobile */
        #strain-chart-panel {
          bottom: 212px;
          right: 8px;
          left: auto;
          width: calc(100vw - 16px);
          height: 124px;
          border-radius: 10px;
        }

        /* About overlay â€” mobile friendly */
        #about-overlay { padding: 16px; }
        .about-card {
          padding: 24px 20px;
          max-width: 100%;
          border-radius: 14px;
        }
        .about-card h2 { font-size: 18px; }
        .about-card .about-desc { font-size: 12px; }

        /* Loading screen */
        .loading-title { font-size: 20px; }
      }

      /* â”€â”€â”€ Spectrogram Panel â”€â”€â”€ */
      #spectrogram-panel {
        position: fixed;
        bottom: 80px;
        right: 16px;
        z-index: 9;
        width: min(420px, calc(100vw - 32px));
        height: 164px;
        border-radius: 10px;
        overflow: hidden;
        display: none;
        background: rgba(0, 0, 0, 0.25);
        backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.05);
      }
      #spectrogram-panel .panel-body {
        height: calc(100% - 25px);
        position: relative;
        display: flex;
        flex-direction: column;
      }
      #spectrogram-panel canvas {
        width: 100%;
        flex: 1;
        min-height: 0;
        display: block;
      }
      #spectrogram-loading {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        color: rgba(255, 255, 255, 0.4);
        letter-spacing: 0.04em;
      }
      #spectrogram-loading .loading-ring {
        width: 16px;
        height: 16px;
        border-width: 1.5px;
        margin-right: 8px;
        margin-bottom: 0;
      }

      /* â”€â”€â”€ Strain Chart Panel â”€â”€â”€ */
      #strain-chart-panel {
        position: fixed;
        bottom: 252px;
        left: 16px;
        z-index: 9;
        width: min(420px, calc(100vw - 32px));
        height: 154px;
        border-radius: 10px;
        overflow: hidden;
        display: none;
        background: rgba(0, 0, 0, 0.25);
        backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.05);
      }
      #strain-chart-panel.has-tabs {
        height: 184px;
      }
      #strain-chart-panel .panel-body {
        height: calc(100% - 25px);
        display: flex;
        flex-direction: column;
      }
      #strain-chart-panel canvas {
        width: 100%;
        flex: 1;
        min-height: 0;
        display: block;
      }

      /* â”€â”€â”€ Draggable Panel Header â”€â”€â”€ */
      .panel-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 4px 8px;
        cursor: grab;
        user-select: none;
        flex-shrink: 0;
        background: rgba(255, 255, 255, 0.03);
        border-bottom: 1px solid rgba(255, 255, 255, 0.04);
        min-height: 24px;
      }
      .panel-header:active { cursor: grabbing; }
      .panel-header-title {
        font-size: 10px;
        color: rgba(255, 255, 255, 0.3);
        text-transform: uppercase;
        letter-spacing: 0.06em;
        font-weight: 500;
      }
      .panel-header-grip {
        width: 28px;
        height: 3px;
        border-radius: 2px;
        background: rgba(255, 255, 255, 0.25);
        flex-shrink: 0;
      }
      .panel-header-inline {
        padding: 0 6px;
        min-height: 0;
        border: none;
        background: none;
        width: 20px;
      }
      .panel-header-inline .panel-header-grip {
        width: 3px;
        height: 16px;
        background: rgba(255, 255, 255, 0.2);
      }
      .panel-minimize-btn {
        width: 20px;
        height: 20px;
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 4px;
        color: rgba(255, 255, 255, 0.45);
        font-size: 15px;
        line-height: 1;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.15s;
        flex-shrink: 0;
        padding: 0;
      }
      .panel-minimize-btn:hover {
        background: rgba(255, 255, 255, 0.12);
        color: rgba(255, 255, 255, 0.8);
        border-color: rgba(255, 255, 255, 0.3);
      }
      .panel-body { transition: max-height 0.2s ease, opacity 0.15s ease; overflow: hidden; }
      .panel-minimized .panel-body { max-height: 0 !important; opacity: 0; overflow: hidden; }
      .panel-minimized { min-height: auto !important; height: auto !important; }
      .panel-minimized canvas { display: none; }
      .panel-minimized #spectrogram-loading { display: none; }
      .panel-dragging {
        opacity: 0.85;
        transition: none !important;
      }
      /* Legacy handle (keep for compat) */
      .panel-drag-handle {
        height: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: grab;
        user-select: none;
        flex-shrink: 0;
      }
      .panel-drag-handle:active { cursor: grabbing; }
      .panel-drag-handle::after {
        content: '';
        width: 32px;
        height: 3px;
        border-radius: 2px;
        background: rgba(255, 255, 255, 0.2);
      }

      /* â”€â”€â”€ Detector Tabs (Researcher mode) â”€â”€â”€ */
      #detector-tabs {
        display: flex;
        align-items: center;
        gap: 2px;
        padding: 4px 8px;
        background: rgba(0, 0, 0, 0.4);
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
      }
      .detector-tab {
        background: transparent;
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 6px;
        color: rgba(255, 255, 255, 0.5);
        font-size: 11px;
        font-family: -apple-system, system-ui, sans-serif;
        padding: 2px 10px;
        cursor: pointer;
        transition: all 0.15s;
        letter-spacing: 0.03em;
      }
      .detector-tab:hover:not(:disabled) {
        color: rgba(255, 255, 255, 0.8);
        border-color: rgba(255, 255, 255, 0.3);
      }
      .detector-tab.active {
        background: rgba(56, 189, 248, 0.2);
        border-color: rgba(56, 189, 248, 0.5);
        color: rgba(56, 189, 248, 0.95);
      }
      .detector-tab:disabled {
        opacity: 0.3;
        cursor: not-allowed;
      }
      .whiten-btn {
        margin-left: auto;
        background: transparent;
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 6px;
        color: rgba(255, 255, 255, 0.5);
        font-size: 10px;
        font-family: -apple-system, system-ui, sans-serif;
        padding: 2px 8px;
        cursor: pointer;
        transition: all 0.15s;
      }
      .whiten-btn:hover {
        color: rgba(255, 255, 255, 0.8);
        border-color: rgba(255, 255, 255, 0.3);
      }
      .whiten-btn.active {
        background: rgba(167, 139, 250, 0.2);
        border-color: rgba(167, 139, 250, 0.5);
        color: rgba(167, 139, 250, 0.95);
      }

      /* â”€â”€â”€ View Mode Gear â”€â”€â”€ */
      #view-mode-gear {
        position: relative;
        margin-left: 2px;
      }
      .gear-btn {
        width: 30px;
        height: 30px;
        background: transparent;
        border: 1px solid transparent;
        border-radius: 8px;
        color: rgba(255, 255, 255, 0.4);
        font-size: 16px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.15s;
      }
      .gear-btn:hover {
        background: rgba(255, 255, 255, 0.06);
        color: rgba(255, 255, 255, 0.7);
      }
      #view-mode-dropdown {
        position: absolute;
        top: 38px;
        right: 0;
        min-width: 220px;
        padding: 8px;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(16px);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 12px;
        display: none;
      }
      #view-mode-dropdown.show { display: block; }
      .mode-label {
        font-size: 10px;
        color: rgba(255, 255, 255, 0.3);
        text-transform: uppercase;
        letter-spacing: 0.08em;
        padding: 4px 10px 6px;
        font-weight: 500;
      }
      .mode-option {
        display: block;
        width: 100%;
        padding: 8px 10px;
        border-radius: 8px;
        border: 1px solid transparent;
        background: transparent;
        color: rgba(255, 255, 255, 0.7);
        font-size: 13px;
        cursor: pointer;
        text-align: left;
        transition: all 0.15s;
        margin-bottom: 2px;
      }
      .mode-option:hover {
        background: rgba(99, 102, 241, 0.1);
        border-color: rgba(99, 102, 241, 0.2);
      }
      .mode-option.active {
        background: rgba(99, 102, 241, 0.15);
        border-color: rgba(99, 102, 241, 0.3);
        color: #a5b4fc;
      }
      .mode-option-desc {
        display: block;
        font-size: 11px;
        color: rgba(255, 255, 255, 0.3);
        margin-top: 1px;
      }
      .mode-option.active .mode-option-desc {
        color: rgba(165, 180, 252, 0.5);
      }

      /* â”€â”€â”€ Scene Selector â”€â”€â”€ */
      #scene-selector {
        position: fixed;
        top: 24px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 30;
        display: flex;
        align-items: center;
        gap: 2px;
        padding: 4px;
        border-radius: 12px;
      }
      .scene-tabs {
        display: flex;
        gap: 2px;
      }
      .scene-tab {
        padding: 6px 16px;
        border-radius: 8px;
        border: 1px solid transparent;
        background: transparent;
        color: rgba(255, 255, 255, 0.45);
        font-size: 12px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.15s;
        letter-spacing: 0.02em;
      }
      .scene-tab:hover {
        background: rgba(255, 255, 255, 0.06);
        color: rgba(255, 255, 255, 0.7);
      }
      .scene-tab.active {
        background: rgba(99, 102, 241, 0.15);
        border-color: rgba(99, 102, 241, 0.3);
        color: #a5b4fc;
      }

      /* â”€â”€â”€ Sandbox Panel â”€â”€â”€ */
      #sandbox-panel {
        position: fixed;
        top: 24px;
        left: 24px;
        z-index: 10;
        padding: 16px 20px;
        min-width: 260px;
        max-width: 300px;
        font-size: 13px;
      }
      .sandbox-title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 12px;
        color: #fff;
      }
      .sandbox-params {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-bottom: 14px;
      }
      .sandbox-row {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .sandbox-row label {
        min-width: 54px;
        font-size: 11px;
        color: rgba(255, 255, 255, 0.45);
      }
      .sandbox-slider {
        flex: 1;
        accent-color: #6366f1;
        height: 4px;
      }
      .sandbox-val {
        min-width: 56px;
        font-size: 11px;
        color: rgba(255, 255, 255, 0.6);
        text-align: right;
        font-variant-numeric: tabular-nums;
      }
      .sandbox-merge-btn {
        width: 100%;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid rgba(99, 102, 241, 0.3);
        background: rgba(99, 102, 241, 0.15);
        color: #a5b4fc;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        letter-spacing: 0.04em;
      }
      .sandbox-merge-btn:hover {
        background: rgba(99, 102, 241, 0.25);
        border-color: rgba(99, 102, 241, 0.5);
        color: #fff;
      }
      .sandbox-hint {
        font-size: 10px;
        color: rgba(255, 255, 255, 0.2);
        margin-top: 10px;
        text-align: center;
      }

      /* â”€â”€â”€ Black Hole Panel â”€â”€â”€ */
      #blackhole-panel {
        position: fixed;
        top: 24px;
        left: 24px;
        z-index: 10;
        padding: 16px 20px;
        min-width: 240px;
        max-width: 280px;
        font-size: 13px;
      }
      .bh-title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 12px;
        color: #fff;
      }
      .bh-params {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-bottom: 10px;
      }
      .bh-row {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .bh-row label {
        min-width: 50px;
        font-size: 11px;
        color: rgba(255, 255, 255, 0.45);
      }
      .bh-slider {
        flex: 1;
        accent-color: #6366f1;
        height: 4px;
      }
      .bh-val {
        min-width: 48px;
        font-size: 11px;
        color: rgba(255, 255, 255, 0.6);
        text-align: right;
        font-variant-numeric: tabular-nums;
      }
      .bh-toggle-label {
        font-size: 12px;
        color: rgba(255, 255, 255, 0.5);
        display: flex;
        align-items: center;
        gap: 6px;
        cursor: pointer;
      }
      .bh-toggle-label input[type="checkbox"] {
        accent-color: #6366f1;
      }
      .bh-hint {
        font-size: 10px;
        color: rgba(255, 255, 255, 0.2);
        text-align: center;
      }

      /* â”€â”€â”€ N-Body Panel â”€â”€â”€ */
      #nbody-panel {
        position: fixed;
        top: 24px;
        left: 24px;
        z-index: 10;
        padding: 16px 20px;
        min-width: 260px;
        max-width: 300px;
        font-size: 13px;
      }
      .nb-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      .nb-expand-btn {
        display: none; /* hidden on desktop */
        background: none;
        border: none;
        color: rgba(255,255,255,0.4);
        font-size: 12px;
        cursor: pointer;
        padding: 2px 6px;
      }
      .nb-title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 12px;
        color: #fff;
      }
      .nb-section {
        margin-bottom: 10px;
        padding-bottom: 8px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
      }
      .nb-row {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 4px;
      }
      .nb-row label {
        min-width: 50px;
        font-size: 11px;
        color: rgba(255, 255, 255, 0.45);
      }
      .nb-select {
        flex: 1;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 6px;
        color: #fff;
        padding: 4px 8px;
        font-size: 11px;
        outline: none;
      }
      .nb-select.nb-small {
        flex: 0 0 auto;
        min-width: 90px;
      }
      .nb-slider {
        flex: 1;
        accent-color: #22c55e;
        height: 4px;
      }
      .nb-val, .nb-speed-val {
        min-width: 36px;
        font-size: 11px;
        color: rgba(255, 255, 255, 0.6);
        text-align: right;
        font-variant-numeric: tabular-nums;
      }
      .nb-btn {
        padding: 4px 10px;
        border-radius: 6px;
        border: 1px solid rgba(255, 255, 255, 0.15);
        background: rgba(255, 255, 255, 0.08);
        color: #fff;
        font-size: 13px;
        cursor: pointer;
        transition: background 0.2s;
      }
      .nb-btn:hover {
        background: rgba(255, 255, 255, 0.15);
      }
      .nb-place-btn {
        width: 100%;
        padding: 8px;
        border-radius: 8px;
        border: 1px solid rgba(34, 197, 94, 0.3);
        background: rgba(34, 197, 94, 0.12);
        color: #86efac;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        margin-top: 4px;
      }
      .nb-place-btn:hover {
        background: rgba(34, 197, 94, 0.25);
        border-color: rgba(34, 197, 94, 0.5);
        color: #fff;
      }
      .nb-toggles {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-bottom: 8px;
      }
      .nb-toggle-label {
        font-size: 11px;
        color: rgba(255, 255, 255, 0.45);
        display: flex;
        align-items: center;
        gap: 4px;
        cursor: pointer;
      }
      .nb-toggle-label input[type="checkbox"] {
        accent-color: #22c55e;
      }
      .nb-info {
        display: flex;
        justify-content: space-between;
        font-size: 10px;
        color: rgba(255, 255, 255, 0.3);
        margin-bottom: 6px;
      }
      .nb-info strong {
        color: rgba(255, 255, 255, 0.6);
      }
      .nb-hint {
        font-size: 10px;
        color: rgba(255, 255, 255, 0.2);
        text-align: center;
      }
      body.nb-placing canvas {
        cursor: crosshair;
      }

      /* â”€â”€â”€ Mobile overrides for new panels â”€â”€â”€ */
      @media (max-width: 768px) {
        #scene-selector {
          top: auto;
          bottom: 70px;
          left: 12px;
          right: 12px;
          transform: none;
          justify-content: center;
          border-radius: 14px;
          padding: 4px 8px;
          z-index: 25;
        }
        .scene-tab {
          padding: 5px 10px;
          font-size: 10px;
          white-space: nowrap;
        }
        #view-mode-dropdown {
          top: auto;
          bottom: 38px;
        }
        #sandbox-panel {
          top: auto; bottom: 120px;
          left: 12px; right: 12px;
          max-width: none; min-width: 0;
          border-radius: 14px;
          padding: 12px 16px;
        }
        #blackhole-panel {
          top: auto; bottom: 120px;
          left: 12px; right: 12px;
          max-width: none; min-width: 0;
          border-radius: 14px;
          padding: 12px 16px;
        }
        #nbody-panel {
          top: auto; bottom: 120px;
          left: 12px; right: 12px;
          max-width: none; min-width: 0;
          border-radius: 14px;
          padding: 10px 14px;
        }
        #nbody-panel .nb-title { font-size: 14px; margin-bottom: 8px; }
        #nbody-panel .nb-expand-btn { display: inline-block; }
        #nbody-panel .nb-section { margin-bottom: 6px; padding-bottom: 6px; }
        #nbody-panel .nb-hint { display: none; }
        #nbody-panel.nb-collapsed .nb-collapsible { display: none; }
        #nbody-panel .nb-info { font-size: 9px; }
      }
    </style>
  </head>
  <body>
    <!-- Loading Screen -->
    <div id="loading-screen">
      <div class="loading-title">WarpLab</div>
      <div class="loading-ring"></div>
      <div class="loading-status" id="loading-status">Connecting to LIGO/Virgo/KAGRA...</div>
    </div>

    <!-- Scene Selector -->
    <div id="scene-selector" class="glass">
      <div class="scene-tabs"></div>
      <div id="view-mode-gear">
        <button class="gear-btn" id="gear-btn" title="View mode">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="3"/>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
          </svg>
        </button>
        <div id="view-mode-dropdown">
          <div class="mode-label">View Mode</div>
          <button class="mode-option active" data-mode="explorer">
            Explorer
            <span class="mode-option-desc">Clean visuals, minimal data</span>
          </button>
          <button class="mode-option" data-mode="student">
            Student
            <span class="mode-option-desc">Labels, equations, guided info</span>
          </button>
          <button class="mode-option" data-mode="researcher">
            Researcher
            <span class="mode-option-desc">Full data tables, parameters, exports</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Map Tooltip -->
    <div id="map-tooltip" class="glass"></div>

    <div id="brand-bar">
      <div id="brand" title="About WarpLab">WARPLAB</div>
      <a href="https://github.com/danielcanton/warplab" target="_blank" rel="noopener noreferrer" class="gh-link" title="Star on GitHub">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
        Star
      </a>
    </div>

    <!-- Event View: Info Panel -->
    <div id="event-info" class="glass">
      <div class="info-header" data-drag-target="event-info">
        <h2 id="event-name">Loading...</h2>
        <div style="display:flex;gap:6px;align-items:center;flex-shrink:0;">
          <button class="export-btn" id="export-btn" title="Export data">
            <svg width="12" height="12" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <path d="M8 1v10M4 7l4 4 4-4"/>
              <path d="M2 13h12"/>
            </svg>
            <span id="export-btn-label">Export</span>
          </button>
          <button class="share-btn" id="share-btn" title="Share this event">
            <svg width="12" height="12" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <path d="M6 3H3a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-3"/>
              <path d="M10 1h5v5"/>
              <path d="M8 8L15 1"/>
            </svg>
          </button>
          <button class="help-btn" id="help-btn" title="What am I looking at? (H)">?</button>
          <button class="panel-minimize-btn" data-minimize-target="event-info" title="Minimize">&#8722;</button>
        </div>
      </div>
      <div class="panel-body">
        <div id="type-badge" class="type-badge bbh"></div>
        <div><span class="param">Masses </span><span class="value" id="masses">&mdash;</span></div>
        <div><span class="param">Distance </span><span class="value" id="distance">&mdash;</span></div>
        <hr class="info-divider">
        <div class="info-detail"><span class="param">Chirp mass </span><span class="value" id="chirp-mass">&mdash;</span></div>
        <div class="info-detail"><span class="param">Final mass </span><span class="value" id="final-mass">&mdash;</span></div>
        <div class="info-detail"><span class="param">Energy radiated </span><span class="value" id="energy-radiated">&mdash;</span></div>
        <div class="info-detail"><span class="param">Eff. spin </span><span class="value" id="chi-eff">&mdash;</span></div>
        <div class="info-detail"><span class="param">Redshift </span><span class="value" id="redshift">&mdash;</span></div>
        <div class="info-detail"><span class="param">SNR </span><span class="snr-badge" id="snr">&mdash;</span></div>
        <div class="info-detail"><span class="param">Confidence </span><span class="pastro-badge" id="p-astro">&mdash;</span></div>
        <div class="info-catalog" id="catalog-name"></div>
      </div>
    </div>

    <!-- Help Overlay -->
    <div id="help-overlay" class="glass">
      <button class="help-close" id="help-close">&times;</button>
      <h2>What am I looking at?</h2>
      <p class="help-intro">
        You're watching two massive objects &mdash; black holes or neutron stars &mdash;
        spiraling into each other and merging. The rippling grid is spacetime itself,
        bending under their gravity. The sound is the gravitational wave signal,
        shifted into the range of human hearing.
      </p>
      <dl class="help-glossary">
        <dt>Masses</dt>
        <dd>How heavy each object is, measured in solar masses (M&#9737; = our Sun's mass)</dd>
        <dt>Chirp mass</dt>
        <dd>A combined mass that determines how the gravitational wave signal "chirps" &mdash; the key parameter detectors measure</dd>
        <dt>Distance</dt>
        <dd>How far away this happened, in megaparsecs (1 Mpc &asymp; 3.26 million light-years)</dd>
        <dt>Final mass</dt>
        <dd>The mass of the merged remnant &mdash; always less than the sum of the two original objects</dd>
        <dt>Energy radiated</dt>
        <dd>Mass converted into gravitational wave energy (E = mc&sup2;). This is the "missing" mass</dd>
        <dt>Effective spin</dt>
        <dd>Whether the objects spin in the same direction (+1) or opposite (&minus;1). Zero means no net spin alignment</dd>
        <dt>Redshift</dt>
        <dd>How much the universe expanded while the waves traveled to us &mdash; higher means older and farther</dd>
        <dt>SNR</dt>
        <dd>Signal-to-noise ratio. Higher = clearer detection. GW150914 had SNR 24, extremely loud</dd>
        <dt>Confidence (p_astro)</dt>
        <dd>Probability this is a real astrophysical event vs. detector noise. &gt; 0.99 means near-certain</dd>
      </dl>
      <dl class="help-glossary">
        <dt>Embed on your site</dt>
        <dd>
          Use an iframe with URL params:<br>
          <code style="font-size:10px;color:#a5b4fc">?embed=true&amp;scene=blackhole</code><br>
          Scenes: <em>merger</em>, <em>sandbox</em>, <em>blackhole</em>, <em>nbody</em>
        </dd>
      </dl>
      <div class="help-footer">
        Data from LIGO / Virgo / KAGRA via GWOSC &bull;
        <span class="kbd">H</span> toggle help &bull;
        <span class="kbd">Esc</span> close
      </div>
    </div>

    <!-- Map View: Legend -->
    <div id="map-legend" class="glass">
      <h2>Gravitational Wave Events</h2>
      <div><span class="legend-dot bbh"></span><span class="legend-label">Binary Black Hole</span></div>
      <div><span class="legend-dot bns"></span><span class="legend-label">Binary Neutron Star</span></div>
      <div><span class="legend-dot nsbh"></span><span class="legend-label">Neutron Star &ndash; Black Hole</span></div>
      <div class="legend-hint">
        Dot size = total mass<br>
        Earth is the green dot at center<br>
        Click any event to inspect it<br>
        <span class="kbd">M</span> toggle map
      </div>
    </div>

    <!-- Event List (shown in both views) -->
    <div id="event-list" class="glass">
      <div class="panel-header" data-drag-target="event-list">
        <span class="panel-header-title">Events</span>
        <div class="panel-header-grip"></div>
        <button class="panel-minimize-btn" data-minimize-target="event-list" title="Minimize">&#8722;</button>
      </div>
      <div class="panel-body">
        <div id="event-count"></div>
        <div class="search-row">
          <input type="text" class="search-input" id="search-input" placeholder="Search events..." />
        </div>
        <div class="filter-bar">
          <button class="filter-chip active" data-type="all">All</button>
          <button class="filter-chip bbh" data-type="BBH">BBH</button>
          <button class="filter-chip bns" data-type="BNS">BNS</button>
          <button class="filter-chip nsbh" data-type="NSBH">NSBH</button>
        </div>
        <div class="sort-row">
          <label>Sort</label>
          <select class="sort-select" id="sort-select">
            <option value="snr">SNR</option>
            <option value="mass">Mass</option>
            <option value="distance">Distance</option>
            <option value="date">Date</option>
          </select>
        </div>
        <div id="event-list-items"></div>
      </div>
    </div>

    <!-- Spectrogram (Student/Researcher modes only) -->
    <div id="spectrogram-panel" class="glass">
      <div class="panel-header" data-drag-target="spectrogram-panel">
        <span class="panel-header-title">Spectrogram</span>
        <div class="panel-header-grip"></div>
        <button class="panel-minimize-btn" data-minimize-target="spectrogram-panel" title="Minimize">&#8722;</button>
      </div>
      <div class="panel-body">
        <canvas id="spectrogram-canvas"></canvas>
        <div id="spectrogram-loading">
          <div class="loading-ring"></div>
          Computing spectrogram...
        </div>
      </div>
    </div>

    <!-- Strain overlay chart (Student/Researcher modes only) -->
    <div id="strain-chart-panel" class="glass">
      <div class="panel-header" data-drag-target="strain-chart-panel">
        <span class="panel-header-title">Strain</span>
        <div class="panel-header-grip"></div>
        <button class="panel-minimize-btn" data-minimize-target="strain-chart-panel" title="Minimize">&#8722;</button>
      </div>
      <div class="panel-body">
        <div id="detector-tabs" style="display:none;">
          <button class="detector-tab active" data-detector="H1">H1</button>
          <button class="detector-tab" data-detector="L1">L1</button>
          <button class="detector-tab" data-detector="V1">V1</button>
          <button id="whiten-toggle" class="whiten-btn" title="Toggle whitened strain">Raw</button>
        </div>
        <canvas id="strain-chart-canvas"></canvas>
      </div>
    </div>

    <!-- Time Controls (event view only) -->
    <div id="time-controls" class="glass">
      <div class="panel-header panel-header-inline" data-drag-target="time-controls">
        <div class="panel-header-grip"></div>
      </div>
      <button class="ctrl-btn" id="play-btn" title="Play/Pause (Space)">&#9654;</button>
      <input type="range" id="time-slider" min="0" max="1000" value="0" />
      <span id="time-label">0.00s</span>
      <button class="ctrl-btn" id="speed-btn" title="Speed (S)">&#9202;</button>
      <span id="speed-label">1x</span>
    </div>

    <!-- Tour Menu -->
    <div id="tour-menu" class="glass">
      <h3>Guided Tours</h3>
      <div id="tour-menu-items"></div>
    </div>

    <!-- Tour Overlay -->
    <div id="tour-overlay" class="glass">
      <div class="tour-header">
        <span class="tour-name" id="tour-name"></span>
        <span class="tour-step-counter" id="tour-step-counter"></span>
      </div>
      <div class="tour-event-name" id="tour-event-name"></div>
      <div class="tour-description" id="tour-description"></div>
      <div class="tour-nav">
        <button class="tour-exit-btn" id="tour-exit-btn">Exit</button>
        <div class="tour-nav-group">
          <button class="tour-nav-btn" id="tour-prev-btn">Prev</button>
          <button class="tour-nav-btn" id="tour-next-btn">Next</button>
        </div>
      </div>
    </div>

    <!-- Bottom Bar -->
    <div id="ui">
      <button class="ui-btn" id="screenshot-btn" title="Screenshot (P)"><svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg><span class="btn-label"> Capture</span></button>
      <button class="ui-btn" id="map-toggle" title="Toggle universe map (M)">Universe Map</button>
      <button class="ui-btn" id="tour-toggle" title="Guided tours (T)">Tours</button>
      <button class="ui-btn mobile-only" id="events-toggle">Events</button>
      <button class="ui-btn" id="vr-button" title="Enter VR" style="display:none;">Enter VR</button>
    </div>

    <!-- Onboarding Hints (first visit) -->
    <div id="onboarding">
      <div class="hint hint-1">
        <strong>Pick an event</strong> from the list to explore different black hole and neutron star mergers
        <span class="hint-dismiss">click anywhere to dismiss</span>
      </div>
      <div class="hint hint-2">
        <strong>Play the merger</strong> &mdash; press <strong>Space</strong> to hear the gravitational wave chirp and watch it unfold
      </div>
      <div class="hint hint-3">
        <strong>Drag to orbit</strong> the binary system. Scroll to zoom in and out
      </div>
      <div class="hint hint-4">
        Press <strong>M</strong> to see all events on a 3D universe map. Press <strong>H</strong> for help
      </div>
    </div>

    <!-- About Overlay -->
    <div id="about-overlay">
      <button class="about-close" id="about-close">&times;</button>
      <div class="about-card">
        <h2>WarpLab</h2>
        <p class="about-tagline">Feel spacetime bend</p>
        <p class="about-desc">
          An interactive gravitational wave visualizer. Explore real events detected by
          LIGO, Virgo, and KAGRA &mdash; watch black holes merge, hear the chirp,
          and navigate the cosmic map of collisions.
        </p>
        <div class="about-links">
          <a href="https://dancanton.com" target="_blank" rel="noopener noreferrer">dancanton.com</a>
          <a href="https://x.com/coco_canton" target="_blank" rel="noopener noreferrer">X / Twitter</a>
          <a href="https://www.linkedin.com/in/danielcantonarg/" target="_blank" rel="noopener noreferrer">LinkedIn</a>
        </div>
        <a href="https://github.com/danielcanton/warplab" target="_blank" rel="noopener noreferrer"
           style="display:inline-flex;align-items:center;gap:6px;margin-top:12px;padding:8px 18px;
                  border-radius:8px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.04);
                  color:rgba(255,255,255,0.5);font-size:13px;text-decoration:none;transition:all 0.2s">
          <svg viewBox="0 0 16 16" width="15" height="15" fill="currentColor">
            <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
          </svg>
          Star on GitHub
        </a>
        <div class="about-credit">
          Data from LIGO / Virgo / KAGRA via GWOSC<br>
          Built by Daniel Canton
        </div>
      </div>
    </div>

    <!-- Share Toast -->
    <div id="share-toast">Link copied!</div>

    <!-- Export Toast -->
    <div id="export-toast">
      <div class="export-spinner"></div>
      <span>Exportingâ€¦</span>
    </div>

    <!-- Draggable + minimizable panels -->
    <script>
    (function() {
      // â”€â”€â”€ Drag â”€â”€â”€
      let active = null, startX, startY, origX, origY;
      function onDown(e) {
        // Support any element with data-drag-target
        const handle = e.target.closest('[data-drag-target]');
        if (!handle) return;
        // Don't drag when clicking buttons
        if (e.target.closest('.panel-minimize-btn, .help-btn, .share-btn, .export-btn, button')) return;
        const id = handle.dataset.dragTarget;
        active = document.getElementById(id);
        if (!active) return;
        const touch = e.touches ? e.touches[0] : e;
        const rect = active.getBoundingClientRect();
        startX = touch.clientX; startY = touch.clientY;
        origX = rect.left; origY = rect.top;
        active.classList.add('panel-dragging');
        e.preventDefault();
      }
      function onMove(e) {
        if (!active) return;
        const touch = e.touches ? e.touches[0] : e;
        const dx = touch.clientX - startX, dy = touch.clientY - startY;
        active.style.left = (origX + dx) + 'px';
        active.style.top = (origY + dy) + 'px';
        active.style.right = 'auto';
        active.style.bottom = 'auto';
        active.style.transform = 'none';
      }
      function onUp() {
        if (active) active.classList.remove('panel-dragging');
        active = null;
      }
      document.addEventListener('mousedown', onDown);
      document.addEventListener('mousemove', onMove);
      document.addEventListener('mouseup', onUp);
      document.addEventListener('touchstart', onDown, {passive: false});
      document.addEventListener('touchmove', onMove, {passive: false});
      document.addEventListener('touchend', onUp);

      // â”€â”€â”€ Minimize / Restore â”€â”€â”€
      document.addEventListener('click', function(e) {
        const btn = e.target.closest('.panel-minimize-btn');
        if (!btn) return;
        const id = btn.dataset.minimizeTarget;
        const panel = document.getElementById(id);
        if (!panel) return;
        const isMin = panel.classList.toggle('panel-minimized');
        btn.innerHTML = isMin ? '&#43;' : '&#8722;';
        btn.title = isMin ? 'Restore' : 'Minimize';
      });
    })();
    </script>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
